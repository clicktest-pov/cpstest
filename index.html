<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CPS Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #fff;
  text-align: center;
  padding: 20px;
}

h1 { font-size: 32px; }
button {
  padding: 10px 18px;
  margin: 5px;
  font-size: 15px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}
.mode { background: #eaeaea; }

#clickArea {
  margin: 20px auto;
  padding: 35px;
  background: #2c2c2c;
  font-size: 24px;
  border-radius: 12px;
}
.disabled { opacity: 0.5; pointer-events: none; }

table {
  margin: 20px auto;
  border-collapse: collapse;
  width: 90%;
  max-width: 420px;
}
th, td {
  border: 1px solid #444;
  padding: 6px;
}
th { background: #222; }

input {
  padding: 8px;
  border-radius: 6px;
  border: none;
}
</style>
</head>

<body>

<h1>üî• CPS Test</h1>

<div id="nicknameBox">
  <p>Enter your nickname:</p>
  <input id="nicknameInput" placeholder="Nickname">
  <button onclick="saveNick()">Save</button>
</div>

<p id="currentNick"></p>

<div>
  <button class="mode" onclick="start(1)">1s</button>
  <button class="mode" onclick="start(5)">5s</button>
  <button class="mode" onclick="start(10)">10s</button>
  <button class="mode" onclick="start(30)">30s</button>
  <button class="mode" onclick="start(60)">60s</button>
</div>

<div id="clickArea" class="disabled" onclick="registerClick()">CLICK</div>

<p id="info">Choose a mode</p>

<h2>üåç Global TOP-10</h2>
<table id="globalTable"></table>

<h2>üìÖ Weekly TOP-10</h2>
<table id="weeklyTable"></table>

<script>
/* ---------- NICKNAME ---------- */
let nickname = localStorage.getItem("nickname");

function saveNick() {
  const input = document.getElementById("nicknameInput").value.trim();
  if (input.length < 2) return alert("Nickname too short");
  localStorage.setItem("nickname", input);
  location.reload();
}

if (nickname) {
  document.getElementById("nicknameBox").style.display = "none";
  document.getElementById("currentNick").innerText = "üë§ " + nickname;
}

/* ---------- VARIABLES ---------- */
let clicks = 0;
let active = false;
let timer = null;
let timeLeft = 0;
let clickTimes = [];

const clickArea = document.getElementById("clickArea");
const info = document.getElementById("info");

/* ---------- RECORD STORAGE ---------- */
let global = JSON.parse(localStorage.getItem("globalRecords") || "[]");
let weekly = JSON.parse(localStorage.getItem("weeklyRecords") || "[]");
let weekStart = Number(localStorage.getItem("weekStart")) || Date.now();

/* reset weekly every 7 days */
if (Date.now() - weekStart > 7 * 24 * 60 * 60 * 1000) {
  weekly = [];
  weekStart = Date.now();
  localStorage.setItem("weekStart", weekStart);
  localStorage.setItem("weeklyRecords", "[]");
}

/* ---------- RENDER TABLES ---------- */
function render(table, data) {
  table.innerHTML = "<tr><th>#</th><th>Nick</th><th>CPS</th><th>Mode</th></tr>";
  data.forEach((r, i) => {
    table.innerHTML +=
      `<tr><td>${i+1}</td><td>${r.nick}</td><td>${r.cps}</td><td>${r.mode}s</td></tr>`;
  });
}

render(globalTable, global);
render(weeklyTable, weekly);

/* ---------- CPS ---------- */
function start(sec) {
  if (!nickname) return alert("Enter nickname first");
  clicks = 0;
  clickTimes = [];
  timeLeft = sec;
  active = true;
  clickArea.classList.remove("disabled");
  info.innerText = "Time: " + timeLeft;

  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    info.innerText = "Time: " + timeLeft;
    if (timeLeft <= 0) end(sec);
  }, 1000);
}

function registerClick() {
  if (!active) return;
  const now = performance.now();

  if (clickTimes.length && now - clickTimes.at(-1) < 10) {
    active = false;
    info.innerText = "‚ùå Cheat detected";
    return;
  }

  clickTimes.push(now);
  clicks++;
}

function end(sec) {
  clearInterval(timer);
  active = false;
  clickArea.classList.add("disabled");

  const cps = (clicks / sec).toFixed(2);

  if (cps > 25) {
    info.innerText = "‚ùå Cheat detected";
    return;
  }

  const record = { nick: nickname, cps, mode: sec };

  global.push(record);
  weekly.push(record);

  global.sort((a,b)=>b.cps-a.cps);
  weekly.sort((a,b)=>b.cps-a.cps);

  global = global.slice(0,10);
  weekly = weekly.slice(0,10);

  localStorage.setItem("globalRecords", JSON.stringify(global));
  localStorage.setItem("weeklyRecords", JSON.stringify(weekly));

  render(globalTable, global);
  render(weeklyTable, weekly);

  info.innerText = `Result: ${cps} CPS`;
}
</script>

</body>
</html>
